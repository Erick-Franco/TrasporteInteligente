<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Administrar Asignaciones - Panel Gerente</title>
  <!-- CSS Dedicado -->
  <link rel="stylesheet" href="css/assignments.css">
  <!-- Font Awesome para iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
  <div class="assignments-page">

    <!-- HEADER -->
    <header class="assign-header">
      <h1><i class="fas fa-users-cog"></i> Administrar Asignaciones</h1>
      <div>
        <button id="btn-back" class="btn-back"><i class="fas fa-arrow-left"></i> Volver al Dashboard</button>
      </div>
    </header>

    <!-- FILTROS -->
    <section class="filters-card">
      <div class="filter-group">
        <label for="filter-ruta"><i class="fas fa-route"></i> Filtrar por Ruta</label>
        <select id="filter-ruta" class="filter-control">
          <option value="">Todas las rutas</option>
        </select>
        <button id="btn-edit-ruta" class="btn-edit-route" title="Editar ruta seleccionada"><i
            class="fas fa-palette"></i> Editar Ruta</button>
      </div>

      <div class="filter-group">
        <label for="filter-search"><i class="fas fa-search"></i> Buscar Conductor</label>
        <input id="filter-search" class="filter-control" placeholder="Nombre, licencia o placa..." />
      </div>

      <div class="filter-actions">
        <button id="btn-filter" class="btn-filter">Aplicar Filtros</button>
        <button id="btn-clear" class="btn-clear">Limpiar</button>
      </div>
    </section>

    <!-- LISTA (TABLA) -->
    <section class="assign-list">
      <div class="table-responsive">
        <table class="assign-table">
          <thead>
            <tr>
              <th>Conductor</th>
              <th>Licencia</th>
              <th>Vehículo / Placa</th>
              <th>Ruta Asignada</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="assignments-container">
            <!-- Se llena dinámicamente con JS -->
            <tr>
              <td colspan="6" class="loading">
                <div class="spinner"></div> Cargando datos...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- FIREBASE SDKs (Compat v8) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- Modal de edición/asignación directa -->
    <div id="edit-modal" class="modal" style="display:none;">
      <div class="modal-content">
        <h3>Editar / Asignar Conductor</h3>
        <div class="modal-body">
          <input type="hidden" id="edit-conductor-id">
          <div class="form-row">
            <label for="edit-ruta">Ruta</label>
            <select id="edit-ruta"></select>
          </div>
          <div class="form-row">
            <label for="edit-vehiculo">Vehículo</label>
            <select id="edit-vehiculo"></select>
          </div>
          <div class="form-row">
            <label for="edit-estado">Estado</label>
            <select id="edit-estado">
              <option value="true">Activo</option>
              <option value="false">Inactivo</option>
            </select>
          </div>
        </div>
        <div class="modal-actions">
          <button id="btn-edit-cancel" class="btn">Cancelar</button>
          <button id="btn-edit-save" class="btn btn-primary">Guardar</button>
        </div>
      </div>
    </div>

    <!-- Modal de edición de RUTA -->
    <div id="edit-route-modal" class="modal" style="display:none;">
      <div class="modal-content">
        <h3>Editar Ruta</h3>
        <div class="modal-body">
          <input type="hidden" id="edit-route-id">
          <div class="form-row">
            <label for="edit-route-name">Nombre</label>
            <input id="edit-route-name" type="text" />
          </div>
          <div class="form-row">
            <label for="edit-route-code">Código</label>
            <input id="edit-route-code" type="text" />
          </div>
          <div class="form-row">
            <label for="edit-route-color">Color</label>
            <input id="edit-route-color" type="color" value="#3B82F6" />
          </div>
          <div class="form-row">
            <label for="edit-route-desc">Descripción</label>
            <textarea id="edit-route-desc" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-actions">
          <button id="btn-edit-route-cancel" class="btn">Cancelar</button>
          <button id="btn-edit-route-save" class="btn btn-primary">Guardar Ruta</button>
        </div>
      </div>
    </div>

    <script src="js/firebase-config.js"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/assignments.js"></script>
  </div>
</body>

</html>