// Usar configuraci√≥n directa con TU PUERTO 5434
const { Pool } = require('pg');

// CONFIGURACI√ìN CON TU PUERTO 5434
const dbConfig = {
    host: 'localhost',
    port: 5434,  // ‚ö†Ô∏è TU PUERTO ES 5434
    database: 'transporte_db',
    user: 'postgres',
    password: '123456'  // ‚ö†Ô∏è TU PASSWORD
};

const pool = new Pool(dbConfig);

// Funci√≥n para ejecutar queries
const query = async (text, params) => {
    try {
        const result = await pool.query(text, params);
        return result;
    } catch (error) {
        console.error('Error en query:', error.message);
        throw error;
    }
};

// Funci√≥n para verificar conexi√≥n
const testConnection = async () => {
    try {
        const result = await query('SELECT NOW()');
        console.log('‚úÖ Conexi√≥n a DB verificada');
        return true;
    } catch (error) {
        console.error('‚ùå Error al conectar con DB:', error.message);
        return false;
    }
};

// TODAS LAS RUTAS COMPLETAS
const todasLasRutas = {
    linea18: {
        codigo: 'L18',
        nombre: 'Linea 18',
        descripcion: 'Ruta de transporte urbano en Juliaca - L√≠nea 18',
        tarifa: 1,
        color: '#FF6B35',
        ida: [
            { lat: -15.513720659967747, lng: -70.1761012414583 },
            { lat: -15.513718255251366, lng: -70.17608273451523 },
            { lat: -15.513716403451314, lng: -70.1760638122931 },
            { lat: -15.513715774234853, lng: -70.17604879040604 },
            { lat: -15.513729030206848, lng: -70.1760441895409 },
            { lat: -15.513752272487995, lng: -70.17603022578726 },
            { lat: -15.513763587610553, lng: -70.17601878523497 },
            { lat: -15.513775513358656, lng: -70.17600525487964 },
            { lat: -15.513783260604994, lng: -70.17599001979431 },
            { lat: -15.51378953356181, lng: -70.17597262671063 },
            { lat: -15.51379166374215, lng: -70.17595310119579 },
            { lat: -15.513788994446177, lng: -70.17593485641522 },
            { lat: -15.513783929753584, lng: -70.17591848250075 },
            { lat: -15.51377433333918, lng: -70.17589938169615 },
            { lat: -15.513763771819615, lng: -70.17588501808684 },
            { lat: -15.513749790697933, lng: -70.17587368003649 },
            { lat: -15.513729611565006, lng: -70.17586523368229 },
            { lat: -15.513711261299672, lng: -70.17585858172767 },
            { lat: -15.513699661250419, lng: -70.17585831866349 },
            { lat: -15.513689171075582, lng: -70.17585760479673 },
            { lat: -15.513687687622769, lng: -70.17583678366577 },
            { lat: -15.513684459314526, lng: -70.175821075707 },
            { lat: -15.513680668293059, lng: -70.17580208658634 },
            { lat: -15.513675506347541, lng: -70.17578266266563 },
            { lat: -15.513673708793998, lng: -70.17576248053182 },
            { lat: -15.513670949765494, lng: -70.17574532038681 },
            { lat: -15.513666522915498, lng: -70.17572469863462 },
            { lat: -15.51366149019014, lng: -70.17569961182276 },
            { lat: -15.513658202518728, lng: -70.17567693468455 },
            { lat: -15.513653391854305, lng: -70.17565451775626 },
            { lat: -15.513649636292957, lng: -70.17562908955468 },
            { lat: -15.513647689907113, lng: -70.17560485991815 },
            { lat: -15.513644987976575, lng: -70.17558123710579 },
            { lat: -15.513641530884064, lng: -70.17555879108009 },
            { lat: -15.513638886145063, lng: -70.17553639100656 },
            { lat: -15.513636613279544, lng: -70.17550696624208 },
            { lat: -15.513632810027687, lng: -70.17547757470156 },
            { lat: -15.513631349195638, lng: -70.17544961036627 },
            { lat: -15.513628753499571, lng: -70.17542310463108 },
            { lat: -15.513624231332981, lng: -70.17539909694398 },
            { lat: -15.51362251409707, lng: -70.17537485339025 },
            { lat: -15.51361850993834, lng: -70.1753453919969 },
            { lat: -15.51361489467075, lng: -70.17531479735254 },
            { lat: -15.51361237978016, lng: -70.17528610877264 },
            { lat: -15.513609370588586, lng: -70.17525587464274 },
            { lat: -15.51360565533503, lng: -70.17522296868461 },
            { lat: -15.513600610099916, lng: -70.1751908349356 },
            { lat: -15.513597277507673, lng: -70.17516097445642 },
            { lat: -15.51359248067048, lng: -70.17513067626457 },
            { lat: -15.513591103301136, lng: -70.17509814122008 },
            { lat: -15.513586216382405, lng: -70.17505968286632 },
            { lat: -15.513580859049485, lng: -70.17502306047957 },
            { lat: -15.513576000363532, lng: -70.17497319430966 },
            { lat: -15.513572855740085, lng: -70.17492596085584 },
            { lat: -15.5135680877562, lng: -70.17488251527901 },
            { lat: -15.513561462570546, lng: -70.1748384917331 },
            { lat: -15.513557220038262, lng: -70.1747898335754 },
            { lat: -15.513552220024998, lng: -70.17476126686769 },
            { lat: -15.513548840515146, lng: -70.17472987639326 },
            { lat: -15.513545322239207, lng: -70.17470328805369 },
            { lat: -15.51354274546394, lng: -70.17467726063157 },
            { lat: -15.513540259430611, lng: -70.17465191515059 },
            { lat: -15.51353754896573, lng: -70.1746269546964 },
            { lat: -15.513532485139036, lng: -70.17459384203829 },
            { lat: -15.513530721941644, lng: -70.17456562847828 },
            { lat: -15.513524978994315, lng: -70.17453313415646 },
            { lat: -15.513523005022682, lng: -70.1745043360472 },
            { lat: -15.513517643211324, lng: -70.17447312621266 },
            { lat: -15.513514023855054, lng: -70.17443969529472 },
            { lat: -15.513509403178698, lng: -70.17439881791489 },
            { lat: -15.51350597516984, lng: -70.17436281234926 },
            { lat: -15.513500230412994, lng: -70.1743223273566 },
            { lat: -15.51349800695262, lng: -70.1742867471098 },
            { lat: -15.513492135630676, lng: -70.17424757329908 },
            { lat: -15.513487748141559, lng: -70.1742106117282 },
            { lat: -15.513483740505324, lng: -70.17416856910155 },
            { lat: -15.513479214386528, lng: -70.17413036123507 },
            { lat: -15.513473390516094, lng: -70.17408524156185 },
            { lat: -15.513467273701941, lng: -70.17403106464252 },
            { lat: -15.513462502224929, lng: -70.17397538843002 },
            { lat: -15.513456541845368, lng: -70.17392512239003 },
            { lat: -15.51344995405407, lng: -70.17387844970484 },
            { lat: -15.513444183738233, lng: -70.17383145582451 },
            { lat: -15.513440983584555, lng: -70.17379368891642 },
            { lat: -15.513436797446328, lng: -70.17376438252633 },
            { lat: -15.513435063329803, lng: -70.17373303376394 },
            { lat: -15.5134293282838, lng: -70.17369075785099 },
            { lat: -15.51342434254493, lng: -70.17364487893174 },
            { lat: -15.513419892572378, lng: -70.17360513001832 },
            { lat: -15.51341383692776, lng: -70.17356882205438 },
            { lat: -15.513412492000876, lng: -70.17353350174022 },
            { lat: -15.51340760326119, lng: -70.17349511874288 },
            { lat: -15.513400680737513, lng: -70.17345221302809 },
            { lat: -15.513395344703813, lng: -70.17340519324243 },
            { lat: -15.513391080268436, lng: -70.17335414170049 },
            { lat: -15.513387421983525, lng: -70.17331437513965 },
            { lat: -15.51338407472797, lng: -70.17327369139737 },
            { lat: -15.513378009622768, lng: -70.17323691709078 },
            { lat: -15.513374700506136, lng: -70.17319880316207 },
            { lat: -15.513368727932123, lng: -70.17316269473523 },
            { lat: -15.513363836724059, lng: -70.17312901407635 },
            { lat: -15.513360500510448, lng: -70.17308253775583 },
            { lat: -15.513315342676172, lng: -70.17268502866072 },
            { lat: -15.51328756049663, lng: -70.17246998994221 },
            { lat: -15.513264396389713, lng: -70.1722446800552 },
            { lat: -15.513257757339222, lng: -70.17217866941805 },
            { lat: -15.513254719962081, lng: -70.1721660819523 },
            { lat: -15.513262218940314, lng: -70.17215903279171 },
            { lat: -15.51327338689358, lng: -70.17214324883426 },
            { lat: -15.51328514540201, lng: -70.17212756204302 },
            { lat: -15.513287679458026, lng: -70.17212271845553 },
            { lat: -15.51325978852224, lng: -70.17210154384131 },
            { lat: -15.513069357923213, lng: -70.17194147346015 },
            { lat: -15.512922811151533, lng: -70.17181432214927 },
            { lat: -15.512854822825885, lng: -70.17174536441856 },
            { lat: -15.512777177873046, lng: -70.17166393812255 },
            { lat: -15.512567477998832, lng: -70.1714736512305 },
            { lat: -15.511778856669132, lng: -70.1707576681628 },
            { lat: -15.511337570900045, lng: -70.1703572036847 },
            { lat: -15.510969614123194, lng: -70.1700214360947 },
            { lat: -15.510930666345063, lng: -70.16998154066117 },
            { lat: -15.510895880740009, lng: -70.16993964261286 },
            { lat: -15.510871475801578, lng: -70.16990862761138 },
            { lat: -15.510684343466469, lng: -70.16966563649724 },
            { lat: -15.510299813391201, lng: -70.16915979853842 },
            { lat: -15.510134717812258, lng: -70.16893586204165 },
            { lat: -15.510005905225489, lng: -70.16875120997297 },
            { lat: -15.509419732322621, lng: -70.1678966748882 },
            { lat: -15.509313688535162, lng: -70.16773128614402 },
            { lat: -15.508927449476326, lng: -70.16715731518603 },
            { lat: -15.508738168720143, lng: -70.16688571749312 },
            { lat: -15.508375404295052, lng: -70.16635686306435 },
            { lat: -15.507849657882172, lng: -70.16558937546523 },
            { lat: -15.507059857164602, lng: -70.16444233837385 },
            { lat: -15.506708595799289, lng: -70.16393216675668 },
            { lat: -15.506466930822835, lng: -70.16360095179564 },
            { lat: -15.505778406995125, lng: -70.16257555411137 },
            { lat: -15.504749182796543, lng: -70.16111874068059 },
            { lat: -15.503996385834109, lng: -70.16005994409836 },
            { lat: -15.50394485164312, lng: -70.15998400588931 },
            { lat: -15.503276392057083, lng: -70.15887138821553 },
            { lat: -15.502994722026022, lng: -70.15825455208508 },
            { lat: -15.50293953475874, lng: -70.15811932109735 },
            { lat: -15.50271624932221, lng: -70.15756983775185 },
            { lat: -15.502407480278404, lng: -70.1568603942372 },
            { lat: -15.50111581399372, lng: -70.15370873543006 },
            { lat: -15.501048142135808, lng: -70.1535610396935 },
            { lat: -15.50104022741146, lng: -70.15349331217526 },
            { lat: -15.501061236343977, lng: -70.15337629293336 },
            { lat: -15.501063640436548, lng: -70.15317218102754 },
            { lat: -15.500972360865891, lng: -70.15289670636109 },
            { lat: -15.500786922273615, lng: -70.15245289047719 },
            { lat: -15.500595363349202, lng: -70.15199962181559 },
            { lat: -15.50041434674659, lng: -70.15156350613236 },
            { lat: -15.500229813779283, lng: -70.15111081755269 },
            { lat: -15.500060415841709, lng: -70.15066413056502 },
            { lat: -15.49988715188795, lng: -70.15022879740991 },
            { lat: -15.499709857274034, lng: -70.14977403145178 },
            { lat: -15.499536162431983, lng: -70.14932853992094 },
            { lat: -15.499351132291757, lng: -70.148887051473 },
            { lat: -15.49917101612468, lng: -70.14845571190592 },
            { lat: -15.499015787704774, lng: -70.14816471857088 },
            { lat: -15.499002621279196, lng: -70.14813837911132 },
            { lat: -15.499016933460616, lng: -70.14809156654093 },
            { lat: -15.499019234780217, lng: -70.1480755156683 },
            { lat: -15.499023100815092, lng: -70.14805036272001 },
            { lat: -15.499025794834523, lng: -70.14802276523723 },
            { lat: -15.499024535919734, lng: -70.14800602720621 },
            { lat: -15.499013791474791, lng: -70.14797203217356 },
            { lat: -15.498996394934885, lng: -70.14792953075839 },
            { lat: -15.49897582128873, lng: -70.14790299503375 },
            { lat: -15.498947694151033, lng: -70.14787858230306 },
            { lat: -15.498921502036534, lng: -70.14785717433517 },
            { lat: -15.498896475923994, lng: -70.14783991047989 },
            { lat: -15.498897634926847, lng: -70.14779964466429 },
            { lat: -15.498896152909316, lng: -70.14776064842839 },
            { lat: -15.498889756283017, lng: -70.14771649324943 },
            { lat: -15.498873674768797, lng: -70.14766855968173 },
            { lat: -15.498856439469959, lng: -70.14763236920588 },
            { lat: -15.498836793756407, lng: -70.14759567842965 },
            { lat: -15.498642103661837, lng: -70.14718782378301 },
            { lat: -15.49842895133189, lng: -70.1467445454629 },
            { lat: -15.49813532684466, lng: -70.14614743356073 },
            { lat: -15.497924224169692, lng: -70.14570503363788 },
            { lat: -15.497731398160054, lng: -70.14526147712088 },
            { lat: -15.497417871200268, lng: -70.1445582750767 },
            { lat: -15.497265297137917, lng: -70.1442768926573 },
            { lat: -15.497111909059605, lng: -70.14397475993466 },
            { lat: -15.496882720707243, lng: -70.14353918224933 },
            { lat: -15.496685388729823, lng: -70.14312444210029 },
            { lat: -15.49646815231855, lng: -70.14267336745837 },
            { lat: -15.496283100172803, lng: -70.14229870734063 },
            { lat: -15.496252513818511, lng: -70.14224598820563 },
            { lat: -15.496174453286587, lng: -70.14213379388153 },
            { lat: -15.496089017711157, lng: -70.14203145406393 },
            { lat: -15.496020204971472, lng: -70.1419670733532 },
            { lat: -15.495947130921524, lng: -70.1419056266197 },
            { lat: -15.49589240247784, lng: -70.1418603119643 },
            { lat: -15.495582556180851, lng: -70.14159543448316 },
            { lat: -15.495402409111863, lng: -70.1414395731795 },
            { lat: -15.495291794908026, lng: -70.14139518418152 },
            { lat: -15.495189874561344, lng: -70.14131180377824 },
            { lat: -15.494965480569082, lng: -70.14110541263688 },
            { lat: -15.494757643499742, lng: -70.14088761192214 },
            { lat: -15.49456013964979, lng: -70.14070706709484 },
            { lat: -15.4942581783712, lng: -70.14041448825985 },
            { lat: -15.493963300146184, lng: -70.14013757941696 },
            { lat: -15.492621220077474, lng: -70.13894016393883 },
            { lat: -15.49222960582927, lng: -70.13886884771047 },
            { lat: -15.49133842381063, lng: -70.13868327522921 },
            { lat: -15.489579315839658, lng: -70.13834951442612 },
            { lat: -15.488598459692623, lng: -70.13816418320637 },
            { lat: -15.488675294821777, lng: -70.13778904968257 },
            { lat: -15.488841958452928, lng: -70.13707019101624 },
            { lat: -15.489095424890898, lng: -70.1360160539111 },
            { lat: -15.489342879754654, lng: -70.13498104937466 },
            { lat: -15.489328444778721, lng: -70.13484816637262 },
            { lat: -15.489279845344033, lng: -70.1346763530907 },
            { lat: -15.489973555655101, lng: -70.13441375012847 },
            { lat: -15.490376225155131, lng: -70.13426859062024 },
            { lat: -15.490884798198326, lng: -70.13405739776802 },
            { lat: -15.491545730470747, lng: -70.13382570272714 },
            { lat: -15.492207927461871, lng: -70.13356945863721 },
            { lat: -15.49266317882184, lng: -70.13337590027578 },
            { lat: -15.4938740400511, lng: -70.13291082315962 },
            { lat: -15.49464033815336, lng: -70.13259854694101 },
            { lat: -15.494646686715804, lng: -70.13259581626903 },
            { lat: -15.494594702221006, lng: -70.1324578629818 },
            { lat: -15.494386250543124, lng: -70.13189788751745 },
            { lat: -15.493688524365233, lng: -70.1299558109509 },
            { lat: -15.492045770582331, lng: -70.12556389235714 },
            { lat: -15.491813815173604, lng: -70.1249897222583 },
            { lat: -15.49159431785935, lng: -70.12434913253345 },
            { lat: -15.491205439843077, lng: -70.12338512805154 },
            { lat: -15.48844616333001, lng: -70.12446568664049 },
            { lat: -15.485814463150989, lng: -70.12549648909119 },
            { lat: -15.48499239367903, lng: -70.1246443218977 },
            { lat: -15.481141034514883, lng: -70.1206994345081 },
            { lat: -15.480454146237214, lng: -70.1200200544094 },
            { lat: -15.480536001578889, lng: -70.11990551244966 },
            { lat: -15.481898572037506, lng: -70.11862119445611 },
            { lat: -15.482639845740309, lng: -70.1180075390174 },
            { lat: -15.480961237961544, lng: -70.11393078996778 },
            { lat: -15.480303275414592, lng: -70.11346376850314 },
            { lat: -15.480449438068838, lng: -70.11298089438905 },
            { lat: -15.476872304735727, lng: -70.10358317926418 }
        ],
        vuelta: [
            { lat: -15.47677919988915, lng: -70.10342211264302 },
            { lat: -15.47708987851706, lng: -70.10423778483089 },
            { lat: -15.475680424611323, lng: -70.1049764324179 },
            { lat: -15.476032030640447, lng: -70.10596376758738 },
            { lat: -15.473493282223236, lng: -70.10705244724096 },
            { lat: -15.473530760549254, lng: -70.10731624656262 },
            { lat: -15.477671872199942, lng: -70.10929294161033 },
            { lat: -15.478604864763474, lng: -70.11043609972248 },
            { lat: -15.4789291799685, lng: -70.11064522412906 },
            { lat: -15.479260831167807, lng: -70.11039145828668 },
            { lat: -15.479470188892119, lng: -70.11036036696584 },
            { lat: -15.48042592608603, lng: -70.11296302294484 },
            { lat: -15.480279408747878, lng: -70.11352942801803 },
            { lat: -15.479845248607727, lng: -70.11336475457912 },
            { lat: -15.478930905866205, lng: -70.11530810334392 },
            { lat: -15.480900326138263, lng: -70.11736264401578 },
            { lat: -15.479471758789153, lng: -70.11904529824945 },
            { lat: -15.483981706747997, lng: -70.12377061629904 },
            { lat: -15.484352051630045, lng: -70.12472203209623 },
            { lat: -15.488043721393364, lng: -70.12341364427117 },
            { lat: -15.491766167559344, lng: -70.1335473523593 },
            { lat: -15.491797704269928, lng: -70.13383498845836 },
            { lat: -15.491545521780814, lng: -70.13463146910296 },
            { lat: -15.49041342009856, lng: -70.13449601684626 },
            { lat: -15.489415876321647, lng: -70.1348208818367 },
            { lat: -15.489360180117679, lng: -70.13485730151865 },
            { lat: -15.489362234797197, lng: -70.13505092604264 },
            { lat: -15.488581551202254, lng: -70.13814712597605 },
            { lat: -15.488577900402767, lng: -70.1381798007533 },
            { lat: -15.49258975155834, lng: -70.13895504519486 },
            { lat: -15.49261186369621, lng: -70.13896201345293 },
            { lat: -15.493231468513903, lng: -70.13950633309467 },
            { lat: -15.494711291581579, lng: -70.14086410900505 },
            { lat: -15.495274262333313, lng: -70.14141450168447 },
            { lat: -15.495399814069259, lng: -70.14156220256227 },
            { lat: -15.496010634393654, lng: -70.14210023597238 },
            { lat: -15.496098431650715, lng: -70.14218307124744 },
            { lat: -15.497724952316172, lng: -70.14564653554827 },
            { lat: -15.498119357280315, lng: -70.14662237670713 },
            { lat: -15.498653807846711, lng: -70.14793245461864 },
            { lat: -15.498671164499996, lng: -70.14809468295081 },
            { lat: -15.498734510790017, lng: -70.14819608857665 },
            { lat: -15.498754642513125, lng: -70.1482585853081 },
            { lat: -15.500656113355326, lng: -70.15298882247279 },
            { lat: -15.500776645996703, lng: -70.15330485380754 },
            { lat: -15.501024402945331, lng: -70.153579172759 },
            { lat: -15.502012877625383, lng: -70.15597221572087 },
            { lat: -15.502185424471666, lng: -70.15639244481513 },
            { lat: -15.503176617984629, lng: -70.15871242930234 },
            { lat: -15.503249218014377, lng: -70.15886566994769 },
            { lat: -15.504023084110882, lng: -70.16014074444564 },
            { lat: -15.506717593440511, lng: -70.1639896340698 },
            { lat: -15.50801342896143, lng: -70.16586065613791 },
            { lat: -15.508396244450914, lng: -70.16640699849971 },
            { lat: -15.510884266965911, lng: -70.16996714413615 },
            { lat: -15.510995208937233, lng: -70.17007873614044 },
            { lat: -15.513193544141922, lng: -70.17208381182897 },
            { lat: -15.513235673177624, lng: -70.17212051837187 },
            { lat: -15.513240658921406, lng: -70.172167708685 },
            { lat: -15.513601535322382, lng: -70.17532403065316 },
            { lat: -15.513638924484473, lng: -70.17562976588229 },
            { lat: -15.51367248598198, lng: -70.17585910952364 },
            { lat: -15.513636024559075, lng: -70.1758966883683 },
            { lat: -15.51361303601435, lng: -70.17593340775764 },
            { lat: -15.51361184111157, lng: -70.17598189428946 },
            { lat: -15.51363012422934, lng: -70.17601676309846 },
            { lat: -15.513657286156995, lng: -70.17603897846301 },
            { lat: -15.513631395851348, lng: -70.1760623479711 },
            { lat: -15.51359453044795, lng: -70.17604428771739 },
            { lat: -15.513553518761094, lng: -70.17605949689683 },
            { lat: -15.513534575250329, lng: -70.17606937755299 }
        ]
    },

    linea22: {
        codigo: 'L22',
        nombre: 'Linea 22',
        descripcion: 'Ruta de transporte urbano en Juliaca - L√≠nea 22',
        tarifa: 1,
        color: '#32CD32',
        ida: [
            { lat: -15.480390478822146, lng: -70.1286648448945 },
            { lat: -15.480336396286894, lng: -70.12798127312522 },
            { lat: -15.480680898882138, lng: -70.12692298968427 },
            { lat: -15.481310779319399, lng: -70.1272843574312 },
            { lat: -15.482382281072711, lng: -70.12797074169369 },
            { lat: -15.482515653320638, lng: -70.12780114711911 },
            { lat: -15.48273300637262, lng: -70.12768358922014 },
            { lat: -15.485961256069231, lng: -70.12651384764376 },
            { lat: -15.48967335076037, lng: -70.12517643225729 },
            { lat: -15.490811627076397, lng: -70.12483153658387 },
            { lat: -15.491777207024677, lng: -70.12741873152821 },
            { lat: -15.492996699755915, lng: -70.13117939051884 },
            { lat: -15.493260696768637, lng: -70.132029576798 },
            { lat: -15.493222843259645, lng: -70.13235152541141 },
            { lat: -15.49153755921693, lng: -70.13302823023864 },
            { lat: -15.491811868730435, lng: -70.13369677251072 },
            { lat: -15.491805807525356, lng: -70.13388436507218 },
            { lat: -15.491503334012112, lng: -70.13470340948815 },
            { lat: -15.491302833128028, lng: -70.13541316910349 },
            { lat: -15.491120155301987, lng: -70.13650273058205 },
            { lat: -15.490710262087564, lng: -70.13857359799032 },
            { lat: -15.492224722417825, lng: -70.13887630492384 },
            { lat: -15.491366355774453, lng: -70.14370960051964 },
            { lat: -15.491344308251726, lng: -70.14394033327173 },
            { lat: -15.491261305122496, lng: -70.14401304565196 },
            { lat: -15.491202894749087, lng: -70.14410583694487 },
            { lat: -15.49120869758365, lng: -70.14421056394796 },
            { lat: -15.491270721469428, lng: -70.14429260527208 },
            { lat: -15.491428586744696, lng: -70.14434381771416 },
            { lat: -15.491530142955702, lng: -70.1442812950307 },
            { lat: -15.493086222663285, lng: -70.14468244341647 },
            { lat: -15.498120714079676, lng: -70.14661055842292 },
            { lat: -15.498663800187186, lng: -70.14794231363057 },
            { lat: -15.498673996879711, lng: -70.14804649653664 },
            { lat: -15.49867867849182, lng: -70.14814535010562 },
            { lat: -15.498778239462364, lng: -70.14822829286713 },
            { lat: -15.501049760651295, lng: -70.15363572709292 },
            { lat: -15.5029924405354, lng: -70.1582786717909 },
            { lat: -15.50330499721319, lng: -70.15891565224227 },
            { lat: -15.51325376499639, lng: -70.17215006894112 },
            { lat: -15.513637272136128, lng: -70.17564184370279 },
            { lat: -15.513683544259415, lng: -70.17587114953953 },
            { lat: -15.513637967274088, lng: -70.17590997144494 },
            { lat: -15.513618347683641, lng: -70.17595795357977 },
            { lat: -15.513646873940797, lng: -70.17602726079616 },
            { lat: -15.513692408885769, lng: -70.17605315508543 },
            { lat: -15.513740061961691, lng: -70.17603009267222 },
            { lat: -15.51378522414451, lng: -70.17600528430586 },
            { lat: -15.513788870885456, lng: -70.17592276765701 },
            { lat: -15.51372127804649, lng: -70.17586221430606 },
            { lat: -15.513684778090415, lng: -70.17584528797121 },
            { lat: -15.513243591967306, lng: -70.1721363200628 },
            { lat: -15.514470006994134, lng: -70.17321353641994 },
            { lat: -15.515932216661469, lng: -70.17448464540804 },
            { lat: -15.517535461466654, lng: -70.17590756980852 }
        ],
        vuelta: [
            { lat: -15.517518779384577, lng: -70.17589474721159 },
            { lat: -15.513256512049205, lng: -70.17213111803308 },
            { lat: -15.513670299640957, lng: -70.17587433629699 },
            { lat: -15.513615272887401, lng: -70.17591820378728 },
            { lat: -15.513619928356661, lng: -70.17597793121773 },
            { lat: -15.513659936240396, lng: -70.1760368413492 },
            { lat: -15.513720306980323, lng: -70.17606334746996 },
            { lat: -15.513764715376746, lng: -70.17603914002811 },
            { lat: -15.513806565419802, lng: -70.17593860655066 },
            { lat: -15.513695928535148, lng: -70.17585390486364 },
            { lat: -15.51323280939586, lng: -70.17212072980213 },
            { lat: -15.510893224207638, lng: -70.16999765346465 },
            { lat: -15.5036968900732, lng: -70.15971750090108 },
            { lat: -15.498938281492958, lng: -70.14839807013007 },
            { lat: -15.498937604279408, lng: -70.14821761325271 },
            { lat: -15.498989165287371, lng: -70.14810091554789 },
            { lat: -15.499015170308946, lng: -70.14801788343219 },
            { lat: -15.498985348396328, lng: -70.14790767648537 },
            { lat: -15.498880022953836, lng: -70.1478365442837 },
            { lat: -15.498861367734971, lng: -70.1475982411196 },
            { lat: -15.498372545457014, lng: -70.14667335571863 },
            { lat: -15.498226003105351, lng: -70.14636576946984 },
            { lat: -15.497991043382408, lng: -70.1463182372181 },
            { lat: -15.493124736988985, lng: -70.14440951880917 },
            { lat: -15.491585569390288, lng: -70.14407346028771 },
            { lat: -15.491517314199081, lng: -70.14400036589582 },
            { lat: -15.491410324081455, lng: -70.14392255334214 },
            { lat: -15.49132844067538, lng: -70.1439717177122 },
            { lat: -15.49125811398546, lng: -70.14372377720943 },
            { lat: -15.490594218141101, lng: -70.1430085844797 },
            { lat: -15.490664572567507, lng: -70.14292604348219 },
            { lat: -15.491082906877047, lng: -70.14090391982525 },
            { lat: -15.49145048752168, lng: -70.13869458975951 },
            { lat: -15.491858686026559, lng: -70.1366471963027 },
            { lat: -15.492043299326062, lng: -70.13560233052382 },
            { lat: -15.492331273139303, lng: -70.13400351111639 },
            { lat: -15.492552276414596, lng: -70.13339973470983 },
            { lat: -15.494633678172832, lng: -70.13257473194358 },
            { lat: -15.491622648130091, lng: -70.12451459082745 },
            { lat: -15.489664362829838, lng: -70.12516725098479 },
            { lat: -15.485932141991842, lng: -70.12650417342381 },
            { lat: -15.482724489078079, lng: -70.12764396527561 },
            { lat: -15.482385367901472, lng: -70.1279903992159 },
            { lat: -15.481300995507768, lng: -70.12727604835197 },
            { lat: -15.480691221911068, lng: -70.1269347398077 },
            { lat: -15.480537919299564, lng: -70.12675740420231 },
            { lat: -15.480212723643787, lng: -70.12746288983368 },
            { lat: -15.480079336712919, lng: -70.12801797577818 },
            { lat: -15.480122308382285, lng: -70.12856973916675 },
            { lat: -15.478723182291628, lng: -70.12764453930576 },
            { lat: -15.477326381009398, lng: -70.1266654550249 },
            { lat: -15.476634756213468, lng: -70.12621999100233 }
        ]
    },

    lineaNaranjaB: {
        codigo: 'LNB',
        nombre: 'Linea Naranja B',
        descripcion: 'Ruta de transporte urbano en Juliaca - Linea Naranja B',
        tarifa: 1,
        color: '#FF8C00',
        ida: [
            { lat: -15.407232427374128, lng: -70.09561110066603 },
            { lat: -15.410168875406951, lng: -70.09641260288348 },
            { lat: -15.455471468959415, lng: -70.10055773993567 },
            { lat: -15.456857122332995, lng: -70.10169139767821 },
            { lat: -15.4570680906939, lng: -70.10173838634289 },
            { lat: -15.458453883292968, lng: -70.10099415183352 },
            { lat: -15.458798411550937, lng: -70.10085515820325 },
            { lat: -15.461612776839024, lng: -70.10073017133026 },
            { lat: -15.462170616016776, lng: -70.10093636342346 },
            { lat: -15.462597168182217, lng: -70.10139812625552 },
            { lat: -15.464361426026887, lng: -70.10350727060906 },
            { lat: -15.464967360776706, lng: -70.10456212355093 },
            { lat: -15.465020916409157, lng: -70.10482808750537 },
            { lat: -15.463849185243731, lng: -70.10694499389685 },
            { lat: -15.463942079358981, lng: -70.10735641443553 },
            { lat: -15.464087010563405, lng: -70.10747468796544 },
            { lat: -15.468171559475724, lng: -70.10957931717967 },
            { lat: -15.47161617764321, lng: -70.11161339523414 },
            { lat: -15.484144449984791, lng: -70.12393995272753 },
            { lat: -15.487783720231318, lng: -70.13441671543357 },
            { lat: -15.487906161592578, lng: -70.13476120067301 },
            { lat: -15.487621077409637, lng: -70.13529675148578 },
            { lat: -15.487764621221327, lng: -70.13531735035534 },
            { lat: -15.48821120259911, lng: -70.1352287804009 },
            { lat: -15.48858233914511, lng: -70.13507932463995 },
            { lat: -15.488974533532467, lng: -70.13479532718775 },
            { lat: -15.48931132318138, lng: -70.13495026452475 },
            { lat: -15.490049815975864, lng: -70.13513957476952 },
            { lat: -15.49001765999369, lng: -70.13623314620409 },
            { lat: -15.489870827997997, lng: -70.13727021503733 },
            { lat: -15.489722083141606, lng: -70.13841006091491 },
            { lat: -15.49071100815277, lng: -70.13859297078368 },
            { lat: -15.490582351096535, lng: -70.13934693110612 },
            { lat: -15.489943030747447, lng: -70.14253481839212 },
            { lat: -15.49055824129298, lng: -70.14312032893008 },
            { lat: -15.491237384550354, lng: -70.14394724870351 },
            { lat: -15.491225415102562, lng: -70.14407388168046 },
            { lat: -15.491215311955417, lng: -70.1441911266532 },
            { lat: -15.491260072446343, lng: -70.14428227107244 },
            { lat: -15.49134648459769, lng: -70.14433469917181 },
            { lat: -15.49145984227114, lng: -70.14432275156057 },
            { lat: -15.491535700428727, lng: -70.1443001665196 },
            { lat: -15.491963232077536, lng: -70.14438581484565 },
            { lat: -15.49144591851939, lng: -70.14731271297606 },
            { lat: -15.491600025867458, lng: -70.14733948959051 },
            { lat: -15.491236837244092, lng: -70.14960115256805 },
            { lat: -15.491234309370236, lng: -70.15062345417944 },
            { lat: -15.4914171229357, lng: -70.15127650280135 },
            { lat: -15.492105837696661, lng: -70.15105214152969 },
            { lat: -15.493706756040647, lng: -70.15685562039587 },
            { lat: -15.494006471943187, lng: -70.15681003272236 },
            { lat: -15.494400155589755, lng: -70.15666599509572 },
            { lat: -15.498179537257608, lng: -70.154741404219 },
            { lat: -15.50077731991376, lng: -70.153326342767 },
            { lat: -15.501009370543626, lng: -70.15355294596576 },
            { lat: -15.501350896161393, lng: -70.15437479106477 },
            { lat: -15.503290374562383, lng: -70.15888522336964 },
            { lat: -15.510929590920787, lng: -70.17001960731807 },
            { lat: -15.5132404640105, lng: -70.17210739502882 },
            { lat: -15.513674748489805, lng: -70.17583930854579 },
            { lat: -15.513672456731143, lng: -70.17586896995357 },
            { lat: -15.513632317673839, lng: -70.17589309630118 },
            { lat: -15.513610868629867, lng: -70.17595799266793 },
            { lat: -15.513630018855402, lng: -70.17600465198034 },
            { lat: -15.513677170247648, lng: -70.17604937803748 },
            { lat: -15.513636374245173, lng: -70.17609642491985 },
            { lat: -15.51360136245459, lng: -70.17613917410571 }
        ],
        vuelta: [
            { lat: -15.513603787401385, lng: -70.176137819006 },
            { lat: -15.513676259652605, lng: -70.1760496188353 },
            { lat: -15.513628943415846, lng: -70.17600872092963 },
            { lat: -15.513608535043792, lng: -70.17595643261764 },
            { lat: -15.513627356669685, lng: -70.17589184294714 },
            { lat: -15.513670974893632, lng: -70.17586389469268 },
            { lat: -15.513690930743184, lng: -70.17582804202999 },
            { lat: -15.513645642344875, lng: -70.17561931686838 },
            { lat: -15.513260691581138, lng: -70.17216937893386 },
            { lat: -15.511014560743664, lng: -70.17003747853012 },
            { lat: -15.51039376682885, lng: -70.16934450866073 },
            { lat: -15.509573152272687, lng: -70.16815612358823 },
            { lat: -15.503389671052796, lng: -70.15911929159704 },
            { lat: -15.502649792410867, lng: -70.15743074937801 },
            { lat: -15.501051909920943, lng: -70.15354173196977 },
            { lat: -15.500679748997184, lng: -70.15318233585126 },
            { lat: -15.499544431937741, lng: -70.1538484495064 },
            { lat: -15.493963039818762, lng: -70.15676914212005 },
            { lat: -15.493873343269302, lng: -70.1567881907917 },
            { lat: -15.493699328319295, lng: -70.15624618130131 },
            { lat: -15.492314345040928, lng: -70.15097652054345 },
            { lat: -15.492091815733641, lng: -70.1510741015721 },
            { lat: -15.491399667235095, lng: -70.15122771120359 },
            { lat: -15.491261006340489, lng: -70.15065619392743 },
            { lat: -15.491239250490707, lng: -70.14958730217973 },
            { lat: -15.491322186858797, lng: -70.14885944400008 },
            { lat: -15.49159342043744, lng: -70.14735304307544 },
            { lat: -15.491462597569237, lng: -70.14730496355664 },
            { lat: -15.492012932540867, lng: -70.14416401915697 },
            { lat: -15.491679149869494, lng: -70.14406052331252 },
            { lat: -15.491572404474075, lng: -70.14408313318918 },
            { lat: -15.491507407913423, lng: -70.14399757589558 },
            { lat: -15.491383971631201, lng: -70.14394604581076 },
            { lat: -15.491253921036165, lng: -70.14373820644033 },
            { lat: -15.490612934946064, lng: -70.14300468808939 },
            { lat: -15.490668748519854, lng: -70.14292187097719 },
            { lat: -15.49085351447905, lng: -70.141978402302 },
            { lat: -15.491491993136286, lng: -70.13870412430266 },
            { lat: -15.489714179966144, lng: -70.13836787346312 },
            { lat: -15.49002930867145, lng: -70.13622538971916 },
            { lat: -15.490053586958782, lng: -70.13514996100663 },
            { lat: -15.490092621554616, lng: -70.13510104199325 },
            { lat: -15.4901148251279, lng: -70.1350700275928 },
            { lat: -15.49011750055606, lng: -70.13499267918719 },
            { lat: -15.489947004428016, lng: -70.134588490741 },
            { lat: -15.489893338820623, lng: -70.13442713939025 },
            { lat: -15.490858347509834, lng: -70.13404642432903 },
            { lat: -15.490628950672788, lng: -70.13336030436574 },
            { lat: -15.487785243966938, lng: -70.13445514548346 },
            { lat: -15.48443121720861, lng: -70.12481031549568 },
            { lat: -15.48494747500608, lng: -70.12461407217326 },
            { lat: -15.482738883477257, lng: -70.1223096776029 },
            { lat: -15.48090719458462, lng: -70.12052483289926 },
            { lat: -15.472403505958761, lng: -70.11208362815718 },
            { lat: -15.470899599107685, lng: -70.1111056875999 },
            { lat: -15.467878296609024, lng: -70.10928758549316 },
            { lat: -15.4654843931562, lng: -70.108050470446 },
            { lat: -15.463998539662994, lng: -70.10724280061068 },
            { lat: -15.463909496488228, lng: -70.10706922207831 },
            { lat: -15.463918293353196, lng: -70.10695317899977 },
            { lat: -15.463967577006146, lng: -70.10678863044039 },
            { lat: -15.464034751052889, lng: -70.10662294691953 },
            { lat: -15.464938493839155, lng: -70.10504417744394 },
            { lat: -15.464995738697105, lng: -70.1048203372835 },
            { lat: -15.46498575762653, lng: -70.10462469415342 },
            { lat: -15.464801787410185, lng: -70.10422694756845 },
            { lat: -15.464456765591716, lng: -70.103683778319 },
            { lat: -15.464163278836013, lng: -70.10323756587425 },
            { lat: -15.463138800848704, lng: -70.10203736301872 },
            { lat: -15.462410994874011, lng: -70.1012560258025 },
            { lat: -15.462066197633009, lng: -70.10092951698621 },
            { lat: -15.46167133628475, lng: -70.10075170489567 },
            { lat: -15.46110036860647, lng: -70.1007509840849 },
            { lat: -15.45887392732825, lng: -70.10088226766972 },
            { lat: -15.458467989012409, lng: -70.10099732372208 },
            { lat: -15.457726029102465, lng: -70.10140514218037 },
            { lat: -15.457107308071889, lng: -70.10172386932219 },
            { lat: -15.456858598914959, lng: -70.10170928983653 },
            { lat: -15.456277806525149, lng: -70.10119007106519 },
            { lat: -15.455669466350107, lng: -70.10071834426431 },
            { lat: -15.45517267530762, lng: -70.10058956152818 },
            { lat: -15.454348668145965, lng: -70.10043521267971 },
            { lat: -15.410292730717838, lng: -70.096518959721 },
            { lat: -15.406907329429531, lng: -70.09556179494808 }
        ]
    },

    linea55: {
        codigo: 'L55',
        nombre: 'Linea 55',
        descripcion: 'Ruta de transporte urbano en Juliaca - Linea 55',
        tarifa: 1,
        color: '#8A2BE2',
        ida: [
            { lat: -15.51512679432271, lng: -70.17913880428458 },
            { lat: -15.515095341412007, lng: -70.17917182830901 },
            { lat: -15.515063155390195, lng: -70.1792426634294 },
            { lat: -15.515049729995827, lng: -70.1792838700164 },
            { lat: -15.51508737522439, lng: -70.17942779996231 },
            { lat: -15.515125736385912, lng: -70.17962047162655 },
            { lat: -15.515162633083461, lng: -70.17982138597814 },
            { lat: -15.515190332610898, lng: -70.1799088764672 },
            { lat: -15.515237828993369, lng: -70.17997080840057 },
            { lat: -15.51529464527598, lng: -70.18001308518446 },
            { lat: -15.515348847443672, lng: -70.18001374220947 },
            { lat: -15.515465459617666, lng: -70.17998654051334 },
            { lat: -15.515509422454356, lng: -70.17996681710329 }
        ],
        vuelta: [
            { lat: -15.515147883216637, lng: -70.17912667321916 },
            { lat: -15.51520443699191, lng: -70.17911342919905 },
            { lat: -15.515246889381821, lng: -70.17911527947362 },
            { lat: -15.515287280446572, lng: -70.17912819501475 },
            { lat: -15.515326566255426, lng: -70.1791784586628 },
            { lat: -15.515369978512352, lng: -70.17926333344177 },
            { lat: -15.515423380894319, lng: -70.17935887008638 },
            { lat: -15.515462192782346, lng: -70.17942058627 },
            { lat: -15.515523414246367, lng: -70.17954468856985 },
            { lat: -15.515589111954904, lng: -70.17966356358278 },
            { lat: -15.515617591679387, lng: -70.17971164159529 },
            { lat: -15.515622564744257, lng: -70.17977727978958 },
            { lat: -15.515601535326816, lng: -70.17985185951498 },
            { lat: -15.515564665862003, lng: -70.17992321154088 },
            { lat: -15.5155180976428, lng: -70.17995385594706 }
        ]
    }
};

async function insertAllRutas() {
    try {
        console.log('üöå CONECTANDO A POSTGRESQL...');
        console.log('üìã Configuraci√≥n:', {
            host: dbConfig.host,
            port: dbConfig.port,
            database: dbConfig.database,
            user: dbConfig.user
        });
        
        // Verificar conexi√≥n
        const connectionOk = await testConnection();
        if (!connectionOk) {
            throw new Error('No se pudo conectar a la base de datos');
        }
        
        console.log('‚úÖ Conectado a PostgreSQL\n');

        const rutasInsertadas = [];

        // INSERTAR CADA RUTA
        for (const [key, ruta] of Object.entries(todasLasRutas)) {
            console.log(`üìù Insertando ${ruta.nombre}...`);

            try {
                // Insertar ruta principal
                const rutaResult = await query(
                    `INSERT INTO rutas (codigo, nombre, descripcion, color, tarifa) 
                     VALUES ($1, $2, $3, $4, $5) RETURNING id`,
                    [ruta.codigo, ruta.nombre, ruta.descripcion, ruta.color, ruta.tarifa]
                );
                
                const rutaId = rutaResult.rows[0].id;

                // Insertar puntos de IDA
                console.log(`   üìç Insertando ${ruta.ida.length} puntos de IDA...`);
                for (let i = 0; i < ruta.ida.length; i++) {
                    const punto = ruta.ida[i];
                    await query(
                        `INSERT INTO ruta_puntos (ruta_id, latitud, longitud, orden, tipo) 
                         VALUES ($1, $2, $3, $4, 'ida')`,
                        [rutaId, punto.lat, punto.lng, i + 1]
                    );
                }

                // Insertar puntos de VUELTA
                console.log(`   üìç Insertando ${ruta.vuelta.length} puntos de VUELTA...`);
                for (let i = 0; i < ruta.vuelta.length; i++) {
                    const punto = ruta.vuelta[i];
                    await query(
                        `INSERT INTO ruta_puntos (ruta_id, latitud, longitud, orden, tipo) 
                         VALUES ($1, $2, $3, $4, 'vuelta')`,
                        [rutaId, punto.lat, punto.lng, i + 1]
                    );
                }

                // Crear puntos de control
                console.log(`   üõë Creando puntos de control...`);
                await crearPuntosControl(rutaId, ruta.ida, 'ida');
                await crearPuntosControl(rutaId, ruta.vuelta, 'vuelta');

                // Verificar inserci√≥n
                const stats = await query(`
                    SELECT 
                        (SELECT COUNT(*) FROM ruta_puntos WHERE ruta_id = $1 AND tipo = 'ida') as puntos_ida,
                        (SELECT COUNT(*) FROM ruta_puntos WHERE ruta_id = $1 AND tipo = 'vuelta') as puntos_vuelta,
                        (SELECT COUNT(*) FROM puntos_control WHERE ruta_id = $1) as puntos_control
                `, [rutaId]);

                rutasInsertadas.push({
                    nombre: ruta.nombre,
                    id: rutaId,
                    ...stats.rows[0]
                });

                console.log(`   ‚úÖ ${ruta.nombre} insertada (ID: ${rutaId})`);
                console.log(`      üìç IDA: ${stats.rows[0].puntos_ida} puntos`);
                console.log(`      üìç VUELTA: ${stats.rows[0].puntos_vuelta} puntos`);
                console.log(`      üõë Puntos control: ${stats.rows[0].puntos_control}\n`);

            } catch (error) {
                console.error(`   ‚ùå Error insertando ${ruta.nombre}:`, error.message);
                continue; // Continuar con la siguiente ruta si hay error
            }
        }

        // RESUMEN FINAL
        console.log('üéâ PROCESO COMPLETADO!');
        console.log('üìä RESUMEN FINAL:');
        rutasInsertadas.forEach(ruta => {
            console.log(`   - ${ruta.nombre}: ${ruta.puntos_ida + ruta.puntos_vuelta} puntos totales`);
        });

        const totalPuntos = rutasInsertadas.reduce((sum, ruta) => 
            sum + ruta.puntos_ida + ruta.puntos_vuelta, 0
        );
        
        console.log(`\nüìà TOTAL: ${rutasInsertadas.length} rutas insertadas, ${totalPuntos} puntos geogr√°ficos`);
        
        if (rutasInsertadas.length < Object.keys(todasLasRutas).length) {
            console.log(`‚ö†Ô∏è  Advertencia: ${Object.keys(todasLasRutas).length - rutasInsertadas.length} rutas no se insertaron`);
        }

    } catch (error) {
        console.error('‚ùå ERROR GENERAL:', error.message);
        console.log('\nüîß SOLUCI√ìN:');
        console.log('   1. Verifica que PostgreSQL est√© ejecut√°ndose en el puerto 5434');
        console.log('   2. Verifica que la base de datos "transporte_db" exista');
        console.log('   3. Verifica el usuario y contrase√±a');
    } finally {
        await pool.end();
        console.log('\nüîö Conexi√≥n cerrada');
    }
}

async function crearPuntosControl(rutaId, puntos, direccion) {
    const interval = Math.max(10, Math.floor(puntos.length / 8));
    
    for (let i = 0; i < puntos.length; i += interval) {
        if (i < puntos.length) {
            const punto = puntos[i];
            const numeroParadero = Math.floor(i/interval) + 1;
            const nombre = `Paradero ${direccion.toUpperCase()} ${numeroParadero}`;
            
            await query(
                `INSERT INTO puntos_control (ruta_id, nombre, latitud, longitud, orden, tipo, direccion) 
                 VALUES ($1, $2, $3, $4, $5, 'paradero', $6)`,
                [rutaId, nombre, punto.lat, punto.lng, numeroParadero, direccion]
            );
        }
    }
}

// EJECUTAR
insertAllRutas();